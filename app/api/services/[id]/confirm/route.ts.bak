import { NextRequest, NextResponse } from "next/server";

import { handleServiceCompletion } from "@/lib/services/service-completion";

export const dynamic = "force-dynamic";

function normalizeId(raw: unknown): string | null {
  if (typeof raw !== "string") return null;
  try {
    const dec = decodeURIComponent(raw).trim();
    return dec.length ? dec : null;
  } catch {
    return null;
  }
}

type Context = { params: { id: string } };

export async function POST(req: NextRequest, context: Context) {
  const id = normalizeId(params?.id);

  return handleServiceCompletion(req, context, {
    method: "POST",
    operation: "confirm",
  });
}

export async function PUT(req: NextRequest, context: Context) {
  const id = normalizeId(params?.id);

  return handleServiceCompletion(req, context, {
    method: "PUT",
    operation: "confirm",
  });
}
